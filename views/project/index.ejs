<!DOCTYPE html>
<html lang="en">
<head>
    <title>Project creation</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="css/bootstrap-duallistbox.min.css" rel="stylesheet" type="text/css" media="all">
    <link rel='stylesheet' href='\css\bootstrap.min.css'/>
    <link rel='stylesheet' href='\css\form.css'/>
    <link rel='stylesheet' href='\css\jquery-ui.min.css'/>

</head>
<body>
    
    <!-- code for navigation bar starts-->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Project Management</a>
          <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>  
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right ">
            <li class="active"><a href="/home">Home</a></li>
            <li><a href="#">FAQ</a></li> 
            <li><a href="#">About</a></li>
            <li><a href="/signout">Log out</a></li>
          </ul>
        </div>
      </div>
    </div>
     <!--  code for navigation bar ends here-->

    <div class="jumbotron">
      <div class="container">
        <h3 class="lead">Project Creation</h3> 
        <p> To create a new project</p>
      </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <form  class="form-horizontal" role="form">
                    <div class="form-group required">
                        <label for="category" class="control-label col-sm-4 required">Project Category</label>
                        <div class="col-sm-8">
                              <select class="form-control" name="category" id="category" required autofocus>
                                      <option value="">Select a category</option>
                              </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="name" class="control-label col-sm-4 required">Project Name</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="project" placeholder="Project Name" name="project" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Desc" class="control-label col-sm-4 required">Project Description</label>
                        <div class="col-sm-8">
                            <input type="text" id="desc" class="form-control" placeholder="Project Description" name="desc" required >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="lead" class=" control-label col-sm-4">Project Lead</label>
                        <div class="col-sm-8">
                            <input type="text" id="lead"  class="form-control" placeholder="Name of Project Lead" name="lead">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email" class=" control-label col-sm-4 required">Contact Email</label>
                        <div class="col-sm-8">
                            <input type="email" id="email" class="form-control" placeholder="Contact Email id" name="email" required >
                        </div>
                    </div>

                    <div class="form-group">    
                        <label for="locations" class=" control-label col-sm-4 col-xs-12">Locations</label>
                        <div class="col-xs-12 col-sm-8">
                                <select multiple="multiple" size="10" id="locations"></select> 
                        </div>
                    </div>


                    <div class="form-group has-feedback">
                        <label for="period" class=" control-label col-sm-4 col-xs-12">Project Timeframe</label>
                        <div class="col-sm-4 col-xs-6">
                            <input type= "text" id="start-date" class=" form-control" placeHolder="Start Date">
                            <i class="glyphicon glyphicon-calendar form-control-feedback"></i>
                            <span class="error" id="startDateError"></span>
                        </div>
                        <div class="col-sm-4 col-xs-6">
                            <input type= "text" id="end-date" class="form-control" placeholder="End Date">
                            <i class="glyphicon glyphicon-calendar form-control-feedback"></i>
                            <span class="error" id="endDateError"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="funds" class=" control-label col-sm-4 col-xs-12 required">Project Fund</label>

                        <div class="col-sm-6 col-xs-8">
                             <input type="text" id="funds" class="form-control" placeholder="Project fund" name="funds" required><span class="error" id="fundsError"></span>
                        </div>

                        <div class="col-sm-2 col-xs-4">
                              <input id="funds" class="form-control" value="INR" name="currency" required>
                        </div>
                    </div>


                    <div class="form-group">
                        <div class="col-sm-offset-6 col-xs-12 col-xs-offset-3">
                            <button class="btn btn-primary btn-lg" id="submit">Add Project</button>
                        </div>
                    </div>
                </form>
              </div>

        </div>
    </div>

    </body>
    <script src="\js\jquery.js"></script> 
    <script src="\js\jquery-ui.js"></script> 
    <script src="\js\bootstrap.min.js"></script>
    <script src="\js\jquery.bootstrap-duallistbox.min.js"></script>

    <script type="text/javascript">
    
     $(document).ready(function(){


        //Date controls
        $('#start-date , #end-date').datepicker().change(function(){
             $('.error').hide();
             isDateValid($(this));
        });



        //Start and end date validations
        function isDateValid(dateObject){
             var start_date=new Date($('#start-date').val()).getTime();
             var end_date=new Date($('#end-date').val()).getTime();


            if( dateObject.attr('id')=="end-date" && isNaN(start_date)){
                $("#startDateError").html("Please give the start date too").show();
             }

             if(start_date>end_date){
                $("#endDateError").html("End date falls before start date").show();
            }
        }

       //For populating project category dropdown
        $.ajax({
            url:"../projectCategory",
            type:"GET",
            headers:{"Accept":"application/json;odata=verbose"},
            success:function(data){
                for(var i in data){
                    var item=$('<option>'+data[i].name+'</option>');
                    $('#category').append(item);
                }
            },
            error:function(data){
                alert("error");
            }
        });

        //For populating locations list
            $.ajax({
                  url:"../locations",
                  type:"GET",
                  headers:{"Accept":"application/json;odata=verbose"},
                  success:function(data){
                           for(var i in data){
                                  var item=$('<option>'+data[i].location+'</option>');
                                  $('#locations').append(item);
                          }
                    },
                  error:function(data){
                       alert("error");
                   },
                  async:false
             });

        //For handling location list events
             $('#locations').bootstrapDualListbox({
                  bootstrap2compatible    : false,
                  preserveselectiononmove : false,            // 'all' / 'moved' / false
                  moveonselect            : true,             // true/false (forced true on androids, see the comment later)
                  initialfilterfrom       : '',               // string, filter selectables list on init
                  initialfilterto         : '',               // string, filter selected list on init
                  helperselectnamepostfix     : '_helper',    // 'string_of_postfix' / false
                  infotext: 'Showing all {0}',// text when all options are visible / false for no info text
                  infotextfiltered        : '<span class="label label-warning">Filtered</span> {0} from {1}',// when not all of the options are visible due to the filter
                  selectorminimalheight   : 100,
                  showfilterinputs        : true,
                  filterplaceholder       : 'Filter',
                  filtertextclear         : 'show all',
                  nonselectedlistlabel    : false,            // 'string', false
                  selectedlistlabel       : false,            // 'string', false
                  filteronvalues          : false             // filter by selector's values, boolean
         });



        //Validating funds field to accept numbers & decimal alone
         $("#funds").on('keydown', function (e) {

            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57) && (e.which < 96 || e.which > 105) && e.which!=188 && e.which!=190 && e.which!=110 && e.which!=9  ) {
                  //display error message
                  $("#fundsError").html("Please enter valid amount").show().fadeOut(2000);
                  return false;
            }
        });


           //For submitting data
           $('#submit').on('click',function(e){
                     
                    //  var refresh="false";

                      var selectedLoc=[];

                      //Getting selected locations
                      $('#bootstrap-duallistbox-selected-list_ option').each(function(i,selected){
                          selectedLoc[i] = $(selected).text();
                      });

                      var locations=[];

                      //Forming JSON Array for locations
                      for(var i=0;i<selectedLoc.length;i++){
                          locations.push(selectedLoc[i]);
                      }

                      //Forming JSON object for form data to be sent to handle POST
                      var formData=new Object;
                      
                      formData.category=$('option:selected', '#category').val();
                      formData.name=$("#project").val();
                      formData.desc=$("#desc").val();
                      formData.lead=$("#lead").val();
                       formData.email=$("#email").val();
                      formData.start_date=$("#start-date").val();
                      formData.end_date=$("#end-date").val();
                      formData.locations=locations;
                      formData.funds=$("#funds").val();
                      formData.currency=$("#currency").val();
                      formData.updated_at=Date.now();

                      $.ajax({
                            url:"../project/create",
                            type:"POST",
                            data:{
                                loadProds:1,
                                details:formData
                                },
                            dataType:"json",
                            success:function(){
                               // refresh="true";
                                $('form').find("input[type=text],input[type=email],select").val("");
                             },
                            error:function(){
                            
                             },
                            async:false
                        });

                      /*if(refresh=="true")
                           e.preventDefault();*/

                   });
                });

    </script>
</html>
